# みんなの攻略情報 Unity導入手順

## 1. みんなの攻略情報 Unity Plugin

みんなの攻略情報 Unity Pluginは、C#から実行可能なSDKとして提供しております。

### 1-1. 動作環境
 * Unity 4.2.0(4.2.04f) 以降
 * iOS 6.0 以降
 * Android 4.2.2 以降

### 1-2. 用語
 * **"シーン"**  
本プロジェクトでは攻略情報を表示させる各クエスト、ステージ、イベント等を「シーン」と呼称します。

## 2. SDKのダウンロード

準備中

## 3. プロジェクトへの導入

UnityPackageファイルをプロジェクトへインポートして下さい。

 [Unityプロジェクトのインポート](http://docs.unity3d.com/ja/current/Manual/HOWTO-exportpackage.html)

### 各OS毎の設定
* [iOSプロジェクトの設定](./ios/README.md)
* [Androidプロジェクトの設定](./android/README.md)


## 4. SDK機能の実装

C#スクリプトに定義した関数名からSDK機能の呼び出しを行います。

### 4-1. アプリ起動時

アプリケーションの起動時にクライアントID・アプリケーションIDを設定する実装を行ってください。  
各種IDは弊社より別途（ヒアリングシート等で）ご連絡致します。

[実装例]

```c#
Orca.Configure(
  "86b8094d44c175850b18ec31eb9adf71", // クライアントID
  "d1d1b00e741d2417a4a1f55b1eda5bed"  // アプリケーションID
);
```

|パラメータ|内容|必須|備考|
|:------|:------|:------|:------|
|第１引数|クライアントID|必須|弊社で発行しご連絡致します。<br/>|
|第２引数|アプリケーションID|必須|弊社で発行しご連絡致します。<br/>※ iOSとAndroid共通で利用可能|

### 4-2. アプリ起動時(インストール後初回起動時)

アプリケーションをインストール後、**初回起動時** のみ実行するよう実装を行ってください。  

[実装例]

```c#
Orca.Configure(
  "86b8094d44c175850b18ec31eb9adf71", // クライアントID
  "d1d1b00e741d2417a4a1f55b1eda5bed"  // アプリケーションID
);
```

※パラメータは「4-1. アプリ起動時」と共通。

### 4-3. 攻略情報取得

攻略情報を表示する以前のシーンが決定したタイミングで実行するよう実装を行ってください。  
シーンIDは弊社より別途（ヒアリングシート等で）ご連絡致します。

[実装例]

```c#
Orca.GetRecommendPage(
  "65928b3ceeb3e9cb24d917e5532ad332|afc4a607d40edbe7c51853ac3af0910f",  // シーンID（2個取得の場合の例）
  "レベル1",                           // ユーザレベル
  "15",                                // ユーザ経験値
  "勇者"                               // ユーザ設定キャラ
);
```

[実装例（配信制御を利用しない場合）]

```c#
Orca.GetRecommendPage(
  "65928b3ceeb3e9cb24d917e5532ad332",  // シーンID（1個取得の場合の例）
  "",                                  // ユーザレベル
  "",                                  // ユーザ経験値
  ""                                   // ユーザ設定キャラ
);
```

|パラメータ|内容|必須|備考|
|:------|:------|:------|:------|
|第１引数|シーンID|必須|弊社で発行しご連絡致します。<br/>複数取得の場合は、" &#124; "区切りで設定（20個まで）<br/>※ iOSとAndroid共通で利用可能|
|第２引数|ユーザレベル|任意|ユーザレベルで配信制御を行う場合は設定してください。<br/>（設定しない場合は空文字を設定）|
|第３引数|ユーザ経験値|任意|ユーザ経験値で配信制御を行う場合は設定してください。<br/>（設定しない場合は空文字を設定）|
|第４引数|ユーザ設定キャラ|任意|ユーザ設定キャラで配信制御を行う場合は設定してください。<br/>（設定しない場合は空文字を設定）|

### 4-4. 攻略情報表示チェック

攻略情報を表示する前に実行してステータスを確認してください。  

[実装例]

```c#
int result = Orca.CheckRecommendPage("65928b3ceeb3e9cb24d917e5532ad332");
if (result == 1) {
  // 攻略情報表示可能
  // 例えば、攻略情報表示ボタンを表示する処理コードを実装
} else if (result == 2) {
  // 攻略情報の表示の準備ができていない
  // 例えば、再度GetRecommendPageを呼び出すコードを実装
} else if (result == 3) {
  // 攻略情報表示不可能
}
```

|パラメータ|内容|必須|備考|
|:------|:------|:------|:------|
|第１引数|シーンID|必須|弊社で発行しご連絡致します。<br/>複数シーンのチェックはできません。<br/>※ iOSとAndroid共通で利用可能|

|戻り値（ステータス）|内容|
|:------|:------|
|0|みんなの攻略情報SDKの呼出しに失敗|
|1|攻略情報表示可能|
|2|攻略情報の表示の準備ができていない<br/>（準備した攻略情報の有効期限（デフォルト30分）が切れた等）|
|3|攻略情報表示不可能<br/>（初期化の不備や対応していないOSバージョン、予期せぬ不整合等）|

[注意点]  
* ステータスが ”2” の場合、再度「4-3.攻略情報取得」を実行する事で攻略情報を取得出来る可能性があります。  
ただし、配信制御等により表示候補がない場合は再取得を実行してもステータスは変化しません。
* ステータスが ”2” または ”3” の状態で「4-5.攻略情報表示」を実行すると攻略情報は表示されず、  
「現在メンテナンス中です。」のポップアップが表示されます。

### 4-5. 攻略情報表示

攻略情報を表示する際に実行して下さい。

[実装例]

```c#
Orca.ShowRecommendPage(
  "65928b3ceeb3e9cb24d917e5532ad332" // シーンID
  0,                                 // クリア情報
  "{'OptionalData':{'puid':'1234','pname':'山田太郎','level':'レベル1', ・・・ }}" // 任意項目
);
```

[実装例（任意項目を利用しない場合）]

```c#
Orca.ShowRecommendPage(
  "65928b3ceeb3e9cb24d917e5532ad332", // シーンID
  0,                                  // クリア情報
  ""                                  // 任意項目を使用しない
);
```

|パラメータ|内容|必須|備考|
|:------|:------|:------|:------|
|第１引数|シーンID|必須|弊社で発行しご連絡致します。<br/>※ iOSとAndroid共通で利用可能|
|第２引数|クリア情報|必須|ゲームクリアの状態を設定して下さい。<br/>（1:not complete 2:complete 3:before play）|
|第３引数|任意項目|任意|任意項目をJSON形式にて設定して下さい。 <br/>（設定しない場合は空文字を設定）|

【任意項目について】  
設定可能な任意項目は下記をご覧ください。  
任意項目は下記以外にも追加可能です。追加を希望する場合は、別途ご相談下さい。  
各項目は最大128桁まで設定可能です。  
任意項目にマルチバイト文字を使用する場合、スクリプトファイルの文字コードをUTF-8(BOM付き)に変更して下さい。

|任意項目名|key|設定内容|
|:------|:------|:------|
|ユーザID|puid   |ゲーム内のユーザIDを設定|
|ユーザ名|pname  |ゲーム内のユーザ名称を設定|
|対戦ボスキャラ名|bchar  |ゲーム内のボスキャラ名称を設定|
|レベル(ランク)|level  |ユーザのレベル数値または名称を設定|
|経験値|exp  |ユーザの経験値数値または名称を設定|
|設定キャラクタ名|char  |設定しているキャラクタ名を設定|
|HP|hp  |キャラクタのHP数値または名称を設定|
|スタミナ|stm  |キャラクタのスタミナ数値または名称を設定|
|攻撃力|power  |キャラクタの攻撃力数値または名称を設定|
|利用もしくは設定装備/武器関連名|item  |キャラクタの装備・武器などの名称を設定|

### 4-6. 全体的な実装例（SDK機能の実行タイミング）

1. アプリ起動
2. 「4-1.アプリ起動」各種IDの設定
3. ユーザ様のプレイ開始アクション
4. 「4-3.攻略情報取得」
5. 「4-4.攻略情報表示チェック」

6-1. チェックが "1" の場合、ユーザ様がシーン終了時に攻略情報を見るボタンを設置する等の処理  
6-2. チェックが "2" の場合、手順4に戻って再度攻略情報を取得を行う  
6-3. チェックが "3" の場合は、攻略情報がない場合の処理

7-1. ユーザ様が攻略情報を見るアクション（ボタンタップ等）  
7-2. 「4-5.攻略情報表示」  

## 5. その他API

### 5-1. クリエイティブ種別の取得

```c#
int creativeType = Orca.getCreativeType("65928b3ceeb3e9cb24d917e5532ad332"); // シーンID
```

|パラメータ|内容|必須|備考|
|:------|:------|:------|:------|
|第１引数|シーンID|必須|弊社で発行しご連絡致します。<br/>※ iOSとAndroid共通で利用可能|


|戻り値（クリエイティブ種別）|内容|
|:------|:------|
|1|攻略サイトのみ|
|2|攻略動画のみ|
|3|両方|

攻略情報に動画が含まれる場合は、ゲーム内で再生しているBGMを停止することを推奨します。

## 6. SDK導入後のテスト

### 6-1. 確認事項

マーケットへの申請までに、SDKを導入した状態でテストを行い、アプリケーションの動作に問題がないことを確認してください。

1. テスト用端末にて対象アプリを起動
1. **攻略情報** を呼び出す地点(シーンまたはステージ)まで画面遷移する
1. **攻略情報** を表示する
1. **攻略情報** を閉じる

弊社へテスト実行時間をお伝えください。正常にSDK機能が動作しているかログ等で確認致します。  
弊社側の確認にて問題がなければテスト完了となります。

### 6-2. デバッグモードについて

テスト時の確認等の為にデバッグモードをご用意しております。

【デバッグモードの動作】

* 配信制御は行われず、サンプルサイト及びサンプル動画が配信されます。  
* 開発環境の標準出力にログが出力されます。

|デバッグモードシーン|シーンID|
|:------|:------|
|シーン1|fc7f24abc577f37d44b6fb0095dcd976|
|シーン2|aee4857751950eee5441057d436e506a|
|シーン3|ea0a160b2a496c33efe0c9511f61b34f|
|シーン4|c0f7d3256b91dc80faab2d0ca34696e6|
|シーン5|a3c9cc0625a56a2f9abb1400f2e17f80|
|シーン6|46d8ca247c7cdd3f81c0649b1bc3c2fc|
|シーン7|f576372b68c175cb52730f05a510eb86|
|シーン8|3ae0fa5850a7ef180b56617f271124a7|
|シーン9|a353d25ddc95549b6bb848fbf6401510|
|シーン10|a63b500d519653e2306c77213ef91eb9|

テスト完了後は、弊社にてデバッグモードを解除し運用モードとなります。

----

SDK導入に関してお困りの際は、下記のメール宛先にお問い合わせください。

問い合わせ先：z-mediadev@cyber-z.co.jp
